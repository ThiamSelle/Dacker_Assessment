### ARTIE 3 – Réconciliation paiements
## Question 2 : Analyse des résultats et cohérence des données

L'exécution des requêtes de réconciliation révèle une situation globalement rassurante avec néanmoins quelques anomalies significatives qui méritent une attention particulière.

## Analyse globale : Une cohérence majoritaire
La deuxième série de résultats montre que sur les 1000 commandes dédupliquées présentes dans la base, 975 commandes (97.5%) présentent un statut de réconciliation "OK", signifiant une parfaite correspondance entre le montant calculé des commandes et les charges bancaires enregistrées. Cette proportion de 97.5% de cohérence est un indicateur très positif de la santé du système de paiement et de la qualité des processus de réconciliation.
Toutefois, 25 commandes (2.5%) affichent le statut "AUCUN_PAIEMENT", représentant un manque à gagner cumulé de 11 583.12€. Si cette proportion peut sembler faible en termes relatifs, l'impact financier absolu de près de douze mille euros non encaissés constitue une anomalie matérielle qui nécessite une investigation approfondie.

## Analyse par statut de commande : Des patterns révélateurs
L'analyse croisée par statut de commande et statut de réconciliation apporte un éclairage essentiel sur la nature de ces anomalies.

# Commandes expédiées (shipped)
Les commandes au statut "shipped" représentent le volume le plus important avec 862 commandes au total, dont 839 (97.3%) sont parfaitement réconciliées avec un statut "OK". Cependant, 23 commandes expédiées (2.7%) n'ont aucun paiement associé, générant un manque à gagner de 10 714.07€. Le montant moyen de ces commandes problématiques s'élève à 465.83€, soit un montant tout à fait standard et cohérent avec la moyenne générale des commandes expédiées (485.39€).
Cette situation est particulièrement préoccupante car elle signifie que l'entreprise a effectivement expédié des marchandises pour plus de dix mille euros sans avoir enregistré le paiement correspondant. Dans un workflow e-commerce standard, le passage au statut "shipped" devrait être strictement conditionné à la validation préalable d'une transaction bancaire réussie. L'existence de ces 23 commandes suggère soit une faille dans le workflow de validation, soit un délai de synchronisation entre le système de gestion des commandes et le système d'enregistrement des paiements.
Le montant moyen quasi identique entre les commandes expédiées avec paiement (485.39€) et sans paiement (465.83€) écarte l'hypothèse d'un problème spécifique aux commandes de montant élevé ou aux paniers exceptionnels. Les commandes problématiques semblent être un échantillon représentatif de l'ensemble des commandes expédiées, suggérant un problème aléatoire plutôt qu'une fraude ciblée ou un bug affectant une catégorie spécifique de transactions.

# Commandes en attente de paiement (pending_payment)
Les 47 commandes au statut "pending_payment" présentent toutes un statut de réconciliation "OK", avec un montant moyen de 474.42€ et une différence absolue nulle. Ce résultat peut sembler contre-intuitif puisque le statut "pending_payment" suggère explicitement qu'un paiement est en attente. Cependant, cette cohérence parfaite s'explique probablement par le fait que ces commandes ont effectivement des charges bancaires associées, mais que le statut de la commande n'a pas encore été mis à jour pour refléter la réception du paiement.
Cette situation suggère un délai dans la mise à jour des statuts de commandes après la réception des paiements. Le workflow semble être le suivant : la transaction bancaire est capturée et enregistrée dans la table charges, mais un processus batch ou manuel doit ensuite mettre à jour le statut de la commande de "pending_payment" vers "shipped". Ces 47 commandes seraient donc en fait déjà payées mais en attente de traitement opérationnel pour déclencher l'expédition.
Cette interprétation est cohérente avec le fait qu'aucune commande "pending_payment" ne présente d'anomalie de paiement. Si le statut reflétait réellement l'absence de paiement, nous nous attendrions à voir certaines de ces commandes dans la catégorie "AUCUN_PAIEMENT".

# Commandes en cours (open)
Les 49 commandes au statut "open" se décomposent en 47 commandes (95.9%) parfaitement réconciliées avec un statut "OK" et 2 commandes (4.1%) sans paiement associé, représentant un manque à gagner de 869.05€. Le montant moyen des commandes "open" avec paiement est de 456.99€, tandis que celui des commandes sans paiement est légèrement inférieur à 434.52€.
Le statut "open" correspond normalement à des commandes récemment créées qui n'ont pas encore été traitées. La présence de 47 commandes "open" avec des paiements déjà enregistrés suggère que le processus de capture du paiement intervient très rapidement après la création de la commande, probablement de manière quasi-instantanée lors de la validation du panier.
Les 2 commandes "open" sans paiement pourraient s'expliquer par plusieurs scénarios. Premièrement, il peut s'agir de commandes très récentes où le délai de synchronisation entre la création de la commande et l'enregistrement de la transaction n'a pas encore été résorbé. Deuxièmement, ces commandes pourraient utiliser des moyens de paiement différés comme les virements bancaires qui ne génèrent pas immédiatement une charge dans le système. Troisièmement, et c'est le scénario le plus problématique, il pourrait s'agir de commandes créées suite à des erreurs de traitement ou des tentatives de paiement échouées.

# Commandes annulées (canceled)
Les 42 commandes au statut "canceled" présentent toutes un statut de réconciliation "OK" avec un montant moyen de 475.55€ et une différence absolue nulle. Ce résultat est excellent et conforme aux attentes. Il signifie que pour toutes les commandes annulées, soit aucun paiement n'a été capturé initialement (auquel cas la différence serait naturellement nulle), soit les paiements capturés ont été intégralement remboursés.
Cette cohérence parfaite sur les commandes annulées indique que le processus d'annulation et de remboursement fonctionne correctement. Lorsqu'une commande est annulée, le système garantit que le client n'est pas facturé ou, s'il l'a été, qu'il est intégralement remboursé. Cette rigueur dans le traitement des annulations est un point positif pour l'intégrité du système.


## Analyse de la table charges : Confirmation de la qualité des données
La troisième série de résultats, analysant directement la table charges, fournit des informations cruciales sur la structure des données de paiement.
La table charges contient 1078 lignes au total, concernant 1000 commandes distinctes. Cette différence de 78 lignes supplémentaires s'explique par l'existence de commandes ayant généré plusieurs transactions, soit des tentatives multiples, soit des charges suivies de remboursements.
Sur ces 1078 transactions, 1053 ont le statut "succeeded" et seulement 25 ont le statut "failed". Le ratio de réussite de 97.7% (1053/1078) est excellent et cohérent avec le taux de réconciliation "OK" observé précédemment à 97.5%. La différence marginale de 0.2 point de pourcentage s'explique probablement par les commandes ayant nécessité plusieurs tentatives avant d'aboutir à une transaction réussie.
La table contient 1000 charges (type = 'charge') et 78 remboursements (type = 'refund'). Ce ratio de 7.8% de remboursements par rapport aux charges initiales est un indicateur important du taux de retour ou d'annulation post-paiement. Ces 78 remboursements correspondent probablement aux 42 commandes annulées identifiées précédemment, certaines commandes annulées ayant pu générer plusieurs remboursements partiels ou des corrections de montants.
Le fait que la table charges contienne exactement 1000 commandes distinctes, correspondant au nombre total de commandes dans orders_clean, confirme que notre méthodologie de réconciliation est correcte et que nous n'avons pas d'écart structurel entre les deux tables.

# Interprétation des 20 premières anomalies
Revenons maintenant sur les 20 premières lignes de la première requête qui affichaient les plus grandes différences absolues. Avec le contexte apporté par les analyses globales, nous pouvons mieux interpréter ces cas.
Ces 20 commandes font partie des 25 commandes totales présentant le statut "AUCUN_PAIEMENT". Elles représentent les montants les plus élevés parmi ces anomalies, allant de 199.20€ à 1264.84€. Le cumul de ces 20 commandes représente environ 11 000€ des 11 583€ de manque à gagner total, soit 95% de l'impact financier de l'anomalie.
Sur ces 20 commandes, 18 ont le statut "shipped" et 2 ont le statut "open". Cette distribution est cohérente avec l'analyse globale qui a révélé que 23 des 25 commandes sans paiement étaient expédiées et 2 étaient ouvertes. Les 20 premières lignes capturent donc effectivement les cas les plus problématiques parmi l'ensemble des anomalies.
La distribution géographique de ces 20 commandes couvre tous les pays du catalogue : France (8 commandes), Espagne (5 commandes), Belgique (3 commandes), Allemagne (3 commandes) et Italie (2 commandes). Cette répartition géographique large confirme que le problème n'est pas localisé à un prestataire de paiement spécifique ou à une région particulière, mais affecte transversalement l'ensemble des marchés.

## ypothèses explicatives et scénarios probables
Compte tenu de l'ensemble des analyses, plusieurs hypothèses peuvent être formulées pour expliquer ces 25 commandes sans paiement.

# Hypothèse 1 : Délai de synchronisation système
La première hypothèse, la plus optimiste, concerne un délai de synchronisation entre le système de gestion des commandes et le système de paiement. Les paiements auraient été effectivement capturés et encaissés, mais un problème technique ou un délai de traitement batch empêcherait leur enregistrement dans la table charges de notre base de données.
Cette hypothèse est partiellement supportée par le fait que seules 2.5% des commandes sont affectées, suggérant un problème intermittent plutôt que systémique. Cependant, elle est affaiblie par le fait que 18 des 20 commandes les plus problématiques ont le statut "shipped", suggérant qu'elles ne sont pas récentes et qu'un délai de synchronisation raisonnable aurait dû être résorbé.
Pour valider ou invalider cette hypothèse, il faudrait vérifier dans les logs du prestataire de paiement si ces 25 commandes ont effectivement des transactions associées qui n'auraient simplement pas été synchronisées dans notre base de données. Si c'est le cas, le problème est purement technique et sans impact financier réel, nécessitant simplement une correction du processus de synchronisation.

# Hypothèse 2 : Moyens de paiement alternatifs
La deuxième hypothèse impliquerait l'utilisation de moyens de paiement alternatifs non enregistrés dans la table charges. Certains clients pourraient payer par virement bancaire, chèque, ou via des systèmes de paiement différé qui ne génèrent pas automatiquement une entrée dans le système de gestion des transactions en ligne.
Cette hypothèse expliquerait pourquoi des commandes ont été expédiées malgré l'absence de charge enregistrée : l'équipe opérationnelle aurait validé manuellement la réception du paiement via un canal alternatif et déclenché l'expédition. Ces paiements seraient alors enregistrés dans un système comptable parallèle non reflété dans notre analyse.
Cependant, cette hypothèse semble peu probable dans le contexte d'un e-commerce moderne où 97.5% des commandes utilisent manifestement des moyens de paiement électroniques standardisés. De plus, on s'attendrait à ce que les moyens de paiement alternatifs soient proportionnellement plus utilisés pour les commandes de montant élevé, or nous avons constaté que les montants moyens des commandes avec et sans paiement sont quasi identiques.

# Hypothèse 3 : Workflow défaillant avec validation manuelle
La troisième hypothèse suggère un workflow où certaines commandes bénéficient d'une validation manuelle contournant les contrôles automatiques de paiement. Ces commandes pourraient concerner des clients VIP, des commandes d'entreprise avec facturation différée, ou des cas particuliers nécessitant une intervention humaine.
Cette hypothèse est supportée par le faible nombre de cas (25 sur 1000) suggérant des exceptions plutôt qu'un problème systémique. Elle expliquerait également pourquoi ces commandes ont été expédiées malgré l'absence de paiement enregistré : une décision humaine aurait pris la responsabilité de procéder à l'expédition.
Cependant, cette pratique, si elle existe, pose des problèmes de gouvernance et de traçabilité. Les exceptions devraient être documentées et un processus de suivi devrait garantir l'encaissement ultérieur des montants dus.

# Hypothèse 4 : Commandes tests ou internes
La quatrième hypothèse concerne l'existence de commandes tests ou de commandes internes de l'entreprise qui ne sont pas destinées à générer de véritables transactions bancaires. Ces commandes seraient passées pour tester le système, former des équipes, ou transférer des produits entre entrepôts.
Cette hypothèse est cohérente avec le faible nombre de cas et leur distribution aléatoire. Cependant, elle soulève une question de qualité des données : les commandes tests devraient être clairement identifiées comme telles, soit par un statut spécifique, soit en étant exclues de la base de production. Leur présence mélangée avec de vraies commandes clients complique les analyses financières et fausse les métriques de performance.

# Hypothèse 5 : Fraude ou erreur opérationnelle
L'hypothèse la plus pessimiste impliquerait soit une fraude organisée, soit une erreur opérationnelle grave où des commandes auraient été expédiées sans validation adéquate du paiement. Cette situation exposerait l'entreprise à une perte financière directe de 11 583€.
Cette hypothèse est affaiblie par plusieurs éléments. Premièrement, le taux d'anomalie de 2.5% est relativement faible et stable. Deuxièmement, la distribution géographique et temporelle des anomalies semble aléatoire plutôt que systématique. Troisièmement, les montants moyens des commandes problématiques sont standards, écartant l'hypothèse de fraudes ciblées sur des paniers exceptionnels.
Néanmoins, même avec une faible probabilité, cette hypothèse ne peut être totalement écartée sans investigation complémentaire. La vérification manuelle d'un échantillon de ces 25 commandes permettrait de déterminer si les produits ont effectivement été expédiés et reçus par les clients, et si ces clients ont jamais été facturés.

## Impact financier et matérialité
Le manque à gagner total de 11 583.12€ doit être mis en perspective par rapport au chiffre d'affaires global. Avec 975 commandes parfaitement réconciliées et en supposant un montant moyen similaire à celui des commandes expédiées (environ 485€), le chiffre d'affaires total réconcilié s'élève approximativement à 473 000€.
Le manque à gagner de 11 583€ représente donc environ 2.4% du chiffre d'affaires total, ce qui est matériellement significatif mais pas catastrophique. Dans une perspective d'audit financier, un écart de 2.4% nécessiterait une investigation mais n'invaliderait pas nécessairement les états financiers dans leur ensemble.
Cependant, cette perspective financière ne doit pas occulter les implications opérationnelles. Si ces 23 commandes expédiées sans paiement correspondent réellement à des marchandises envoyées sans encaissement, l'entreprise fait face non seulement à une perte de revenu mais également à une perte de stock. L'impact réel pourrait donc être supérieur au simple manque à gagner de 11 583€ si on considère le coût des marchandises vendues.

## Recommandations d'investigation immédiate
Face à ces constats, plusieurs actions d'investigation s'imposent en priorité.
Premièrement, une vérification manuelle d'un échantillon des commandes problématiques est indispensable. En sélectionnant par exemple les 5 commandes avec les montants les plus élevés parmi celles sans paiement, l'équipe devrait vérifier : si les produits ont effectivement été expédiés et livrés, si le client a confirmé la réception, si une facture a été émise, si un paiement a été reçu par un canal alternatif non enregistré dans charges, et si des tentatives de recouvrement ont été effectuées.
Deuxièmement, une consultation des logs du prestataire de paiement est cruciale. Pour chacune des 25 commandes sans paiement enregistré dans notre base, il faut vérifier dans le système du prestataire de paiement si des transactions existent. Si des transactions apparaissent dans leurs logs mais pas dans notre base, le problème est purement technique et peut être résolu par une correction du processus de synchronisation.
Troisièmement, une analyse temporelle détaillée permettrait de déterminer si ces anomalies se concentrent sur une période spécifique suggérant un incident ponctuel, ou si elles sont distribuées uniformément dans le temps suggérant un problème structurel. Cette analyse pourrait être effectuée en croisant les dates de création des 25 commandes problématiques.
Quatrièmement, une revue du workflow de validation des commandes devrait être menée. Il faut documenter précisément les conditions dans lesquelles une commande peut passer au statut "shipped", et vérifier si des exceptions ou des contournements sont possibles. Si des validations manuelles existent, elles doivent être tracées et justifiées.
Cinquièmement, une politique de réconciliation régulière devrait être instaurée si elle n'existe pas déjà. Un processus batch quotidien pourrait comparer les commandes expédiées avec les paiements enregistrés et générer des alertes automatiques en cas d'écart, permettant une détection et une résolution rapides des anomalies avant qu'elles n'accumulent un impact financier significatif.

## Actions correctrices proposées
Au-delà de l'investigation des cas existants, plusieurs actions correctrices systémiques peuvent être recommandées.
Premièrement, le renforcement des contrôles automatiques dans le workflow de gestion des commandes est essentiel. Le passage d'une commande au statut "shipped" devrait être strictement conditionné à l'existence d'une transaction bancaire réussie enregistrée dans la table charges. Aucune exception manuelle ne devrait être possible sans une approbation formelle à un niveau hiérarchique élevé et avec traçabilité complète.
Deuxièmement, l'amélioration de la synchronisation entre systèmes devrait être prioritaire. Si des délais de synchronisation existent entre le système de paiement et le système de gestion des commandes, ils doivent être réduits au minimum. Idéalement, l'enregistrement de la transaction et la mise à jour du statut de commande devraient être atomiques ou quasi-instantanés.
Troisièmement, la mise en place d'un tableau de bord de réconciliation en temps réel permettrait une surveillance continue de la santé du système de paiement. Des indicateurs comme le nombre de commandes expédiées sans paiement, le montant total non réconcilié, et l'ancienneté des anomalies devraient être suivis quotidiennement avec des alertes automatiques en cas de dépassement de seuils prédéfinis.
Quatrièmement, la clarification du traitement des commandes particulières est nécessaire. Si des cas légitimes existent où une commande peut être expédiée sans paiement immédiat, comme des clients corporate avec facturation mensuelle, ces cas doivent être identifiés par un statut ou un flag spécifique et ne pas apparaître comme des anomalies dans les analyses de réconciliation.
Cinquièmement, la documentation et la formation des équipes opérationnelles devraient être renforcées. Tous les acteurs impliqués dans le processus de gestion des commandes doivent comprendre l'importance de la réconciliation paiements et les implications financières des anomalies. Des procédures claires doivent définir les actions à entreprendre en cas de détection d'une commande sans paiement.

## Conclusion sur la cohérence des données
L'analyse complète de la réconciliation paiements révèle une situation globalement satisfaisante avec une cohérence de 97.5% entre les montants de commandes et les charges bancaires. Ce taux élevé indique que le système de paiement fonctionne correctement pour la grande majorité des transactions et que les processus de réconciliation sont globalement fiables.
Cependant, l'existence de 25 commandes sans paiement enregistré, dont 23 ont été expédiées, constitue une anomalie matérielle représentant un manque à gagner de 11 583€. Cette situation nécessite une investigation approfondie pour déterminer si ces commandes correspondent à des pertes financières réelles, à des paiements alternatifs non enregistrés, ou à des problèmes techniques de synchronisation.
Les données sont suffisamment cohérentes pour permettre des analyses business fiables, mais la résolution de ces 25 cas problématiques devrait être considérée comme prioritaire pour garantir l'intégrité financière complète du système. Les recommandations d'investigation et les actions correctrices proposées fournissent un cadre d'action pour traiter ces anomalies de manière systématique et prévenir leur récurrence future.
La transparence apportée par cette analyse de réconciliation est elle-même un indicateur positif de la maturité du système de données de l'entreprise. La capacité à identifier, quantifier et caractériser précisément les anomalies est un prérequis indispensable à leur résolution effective.